<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Senti.co | Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            /* Color Scheme */
            --light-grey: #fafafa;
            --font-label: #303f8e;
            --nav-black: #292929;
            --primary-dark: #182572;
            --primary-light: #4e9ca4;
            --yellow-accent: #f8b237;
            --grey-username: #8a8a8a;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-grey);
            color: var(--nav-black);
        }
        .text-nav-dark { color: var(--nav-black); }
        .text-username { color: var(--grey-username); }
        .text-primary-label { color: var(--font-label); }
        .bg-primary-dark { background-color: var(--primary-dark); }
        .bg-primary-light { background-color: var(--primary-light); }
        .btn-yellow { 
            background-color: var(--yellow-accent); 
            color: var(--primary-dark);
            transition: transform 0.15s ease-in-out, box-shadow 0.15s ease-in-out; 
        }
        .btn-yellow:hover { 
            background-color: #e09f2e;
            transform: scale(1.01); 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); 
        }
        .sentiment-gradient {
            background-image: linear-gradient(to right, var(--primary-dark), var(--primary-light));
        }
        .keyword-chip {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            transition: transform 0.1s ease;
        }
        .keyword-chip:hover {
            transform: translateY(-1px);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Navbar -->
    <nav class="bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="{{ url_for('serve_dashboard') }}" class="h-8 w-24 flex items-center">
                        <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Senti.co Logo" class="h-full object-contain">
                    </a>
                </div>

                <div class="hidden sm:flex items-center space-x-8">
                    <a href="{{ url_for('serve_index') }}" class="text-nav-black font-medium hover:border-b-2 hover:border-nav-dark pb-1">HOME</a>
                    <a href="{{ url_for('serve_dashboard') }}" class="text-nav-black font-semibold border-b-2 border-nav-dark pb-1">DASHBOARD</a>
                    <a href="{{ url_for('serve_use_cases') }}" class="text-nav-black font-medium hover:border-b-2 hover:border-nav-dark pb-1">USE CASES</a>
                    <a href="{{ url_for('serve_help') }}" class="text-nav-black font-medium hover:border-b-2 hover:border-nav-dark pb-1">HELP</a>
                </div>

                <div class="flex items-center space-x-3">
                    <div class="text-right hidden sm:block">
                        <span id="nav-user-name" class="block text-nav-dark text-sm font-semibold">Guest User</span>
                        <a id="nav-user-action" href="{{ url_for('serve_login') }}" class="block text-xs text-username hover:text-primary-dark transition-colors cursor-pointer">Sign up / Login</a>
                    </div>
                    <div class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center overflow-hidden">
                        <img id="nav-profile-pic" src="{{ url_for('static', filename='images/profile-pic.png') }}" alt="Profile" class="w-full h-full object-cover">
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Header of Dashboard Page -->
    <header class="sentiment-gradient text-white pt-8 pb-10 shadow-lg mb-6 sm:mb-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h1 class="text-4xl sm:text-7xl font-extrabold text-center tracking-tight leading-tight">
                Monitor, Analyze,<br>Get Insights
            </h1>
            <p class="text-center text-lg opacity-90 max-w-3xl mx-auto mt-3">
                Paste your text and discover its core sentiment instantly.
            </p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-0 sm:p-6 lg:p-8">
        <div class="px-4 sm:px-0 max-w-4xl mx-auto">
            <div class="space-y-6">
                <section class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                    <!-- Sentiment Analysis Form -->
                    <form id="sentiment-form" method="POST" action="{{ url_for('analyze_sentiment') }}">
                        <label for="sentiment-input" class="block mb-2 text-lg font-semibold text-primary-label">Enter Text or URL for Analysis:</label>
                        <div class="relative mb-4">
                            <textarea id="sentiment-input" name="analysis_text" rows="8" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-primary-dark focus:border-primary-dark outline-none transition duration-150 text-nav-black" placeholder="E.g., The new product is amazing, but the customer service was disappointing.">{% if analysis_data and analysis_data.analysis_text %}{{ analysis_data.analysis_text }}{% endif %}</textarea>
                            <i data-lucide="search" class="absolute top-6 right-4 w-5 h-5 opacity-50 text-primary-dark"></i>
                        </div>
                        <button type="submit" id="analyze-button" class="w-full py-3 btn-yellow font-bold rounded-lg shadow-md transition duration-200 flex items-center justify-center">
                            <span class="mr-2">Analyze Sentiment</span>
                            <i data-lucide="scan-text" class="w-5 h-5"></i>
                        </button>
                    </form>
                </section>

                <!-- Sentiment Analysis Results Section -->
                <section class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                    <h2 class="text-xl font-semibold mb-4 text-primary-label flex items-center">
                        <i data-lucide="bar-chart-2" class="w-5 h-5 mr-2"></i> Sentiment Breakdown (Scores)
                    </h2>
                    <div id="results-placeholder" class="grid grid-cols-3 gap-4 min-h-[120px] items-center justify-center">
                        {% if not analysis_data %}
                            <div class="col-span-3 text-center text-gray-500 py-6" id="initial-result-message">
                                Your Positive, Negative, and Neutral scores will appear here immediately after analysis.
                            </div>
                        {% else %}

                            <!-- Cards for Positive, Neutral and Negative percentage -->
                            <div id="positive-card" class="text-center p-4 rounded-xl shadow-md border-t-8 border-green-500 bg-green-50">
                                <h3 class="font-bold text-lg text-green-700">POSITIVE</h3>
                                <p class="text-3xl font-extrabold text-green-600" id="positive-percentage">{{ analysis_data.results.positive }}%</p>
                            </div>
                            <div id="neutral-card" class="text-center p-4 rounded-xl shadow-md border-t-8 border-gray-400 bg-gray-50">
                                <h3 class="font-bold text-lg text-gray-700">NEUTRAL</h3>
                                <p class="text-3xl font-extrabold text-gray-600" id="neutral-percentage">{{ analysis_data.results.neutral }}%</p>
                            </div>
                            <div id="negative-card" class="text-center p-4 rounded-xl shadow-md border-t-8 border-red-500 bg-red-50">
                                <h3 class="font-bold text-lg text-red-700">NEGATIVE</h3>
                                <p class="text-3xl font-extrabold text-red-600" id="negative-percentage">{{ analysis_data.results.negative }}%</p>
                            </div>
                            <!-- Final Analysis Result -->
                            <div class="col-span-3 text-center pt-4">
                                <p class="text-sm font-bold text-primary-dark">
                                    Dominant Sentiment: <span class="text-lg font-extrabold">{{ analysis_data.results.main_sentiment | upper }}</span>
                                </p>
                            </div>
                        {% endif %}
                    </div>
                </section>
                
                <!-- Relevant Keywords Sections of the Sentiment -->
                <section class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                    <h2 class="text-xl font-semibold mb-4 text-primary-label flex items-center">
                        <i data-lucide="hash" class="w-5 h-5 mr-2"></i> Relevant Keywords & Topics
                    </h2>
                    
                    <div class="flex flex-wrap gap-2" id="keyword-container">
                        <!--Checking analysis_data and its results property for keywords -->
                        {% if analysis_data and analysis_data.results and analysis_data.results.keywords %}
                            {% for keyword in analysis_data.results.keywords %}
                                <span class="keyword-chip 
                                    {% if loop.index0 % 3 == 0 %}bg-primary-dark text-white
                                    {% elif loop.index0 % 3 == 1 %}bg-primary-light text-white
                                    {% else %}bg-yellow-accent text-primary-dark{% endif %} 
                                    text-xs font-semibold px-3 py-1 rounded-full">
                                    #{{ keyword }}
                                </span>
                            {% endfor %}
                        {% else %}
                            <p class="text-sm text-gray-500">This section will extract the most common themes and important keywords identified from your text.</p>
                        {% endif %}
                    </div>
                    <p class="text-sm text-gray-500 mt-4">These are the most recurring themes identified from the text.</p>
                </section>    
            </div>
        </div>
    </main>

    <!-- Footer of the page  -->
    <footer class="bg-gray-200 py-8 mt-10">
        <div class="max-w-7xl mx-auto px-4 text-center text-gray-600">
            &copy; 2025 Senti.co. All rights reserved.
        </div>
    </footer>

    <script type="text/javascript">
        // Store URL paths from Jinja into JS variables
        const DASHBOARD_URL = "{{ url_for('serve_dashboard') }}";
        const LOGIN_URL = "{{ url_for('serve_login') }}";
        const LOGOUT_URL = "{{ url_for('logout_user') }}";
        const DEFAULT_PROFILE_PIC = "{{ url_for('static', filename='images/profile-pic.png') }}";

        // Fetching user info from backend
        async function fetchUserInfo() {
            try {
                const res = await fetch('/api/userinfo');
                return await res.json();
            } catch (err) {
                console.error("Error fetching user info:", err);
                return { logged_in: false };
            }
        }

        async function updateUserInfo() {
            const userNameEl = document.getElementById('nav-user-name');
            const userActionEl = document.getElementById('nav-user-action');
            const getStartedBtn = document.getElementById('get-started-btn');
            const profilePicEl = document.getElementById('nav-profile-pic');
    
            const userData = await fetchUserInfo();

            if (userData.logged_in) {
                // User is logged in
                userNameEl.textContent = userData.name || 'User'; 
                userActionEl.textContent = 'Logout';
                userActionEl.href = LOGOUT_URL; // Link to the Flask logout route
                getStartedBtn.href = DASHBOARD_URL; // Link 'Get Started' to dashboard
                if (userData.profile_pic) {
                     profilePicEl.src = userData.profile_pic;
                }
            } else {
                // User is a guest
                userNameEl.textContent = 'Guest User';
                userActionEl.textContent = 'Login';
                userActionEl.href = LOGIN_URL; // Link to the Flask login route
                getStartedBtn.href = LOGIN_URL; // Link 'Get Started' to login
                profilePicEl.src = DEFAULT_PROFILE_PIC;
            }
        }

        document.addEventListener('DOMContentLoaded', updateUserInfo);
        
        // Alert message if model is not found
        window.alertModal = function(title, message) {
            const existingModal = document.getElementById('custom-modal');
            if (existingModal) existingModal.remove();

            const modalHtml = `
                <div id="custom-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50 transition-opacity duration-300">
                    <div class="bg-white p-6 rounded-lg shadow-2xl w-full max-w-sm transform scale-95 transition-transform duration-300">
                        <h3 class="text-xl font-bold text-primary-dark mb-3">${title}</h3>
                        <p class="text-gray-700 mb-4">${message}</p>
                        <button onclick="document.getElementById('custom-modal').remove()" class="w-full py-2 btn-yellow font-semibold rounded-lg">Close</button>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        // Initialize icons on load
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });

    </script>
</body>
</html>
